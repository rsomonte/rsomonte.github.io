<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Type Identifier</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <header>
        <a href="/" class="home-link">rsomonte&#39;s website</a>
        <nav>
            <h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
            <ul class="nav">
                <li class="nav-item"><a href="/">Home</a></li>
                <li class="nav-item"><a href="/posts/">Blog</a></li>
                <li class="nav-item"><a href="/cv/">Curriculum Vitae</a></li>
                <li class="nav-item"><a href="/file-indentifier/">File Type Identifier</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <div class="message-box">
            <h3>⚠️This web is under construction, please be patient</h3>
            <ol>
                <p>It is a work in progress, so expect many things to change.</p>
                <p>My knowledge in webdev is very limited so expect this website to have many flaws in its initial versions.</p>
            </ol>
        </div>
        <!-- Page-specific content goes here -->
        
<h1>File Type Identifier</h1>
<p>Select a file from your computer to identify its type using Rust and WebAssembly. The entire process runs locally in your browser.</p>

<input type="file" id="upload" class="message-box" />
<hr>
<h3>Results:</h3>
<pre id="results"; class="message-box">Awaiting file...</pre>

<script type="module">
  // Import the wasm-pack generated JS and your Wasm function
  import init, { identify_file_wasm } from '/pkg/filetype_wasm.js';

  async function main() {
    // Initialize the Wasm module.
    await init();

    const fileInput = document.getElementById('upload');
    const resultsOutput = document.getElementById('results');

    fileInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (!file) {
        resultsOutput.textContent = 'Awaiting file...';
        return;
      }

      const reader = new FileReader();

      // This function runs AFTER the file is read successfully
      reader.onload = (e) => {
        // Get the file's bytes as a Uint8Array
        const bytes = new Uint8Array(e.target.result);
        
        // Call your Rust function!
        const fileInfo = identify_file_wasm(bytes);
        
        // Display the result
        resultsOutput.textContent = fileInfo;
      };
      
      // This function runs if there's an error reading the file
      reader.onerror = () => {
          resultsOutput.textContent = `Error: Could not read the file "${file.name}".`;
      };

      resultsOutput.textContent = `Analyzing "${file.name}"...`;
      
      // Start reading the file
      reader.readAsArrayBuffer(file);
    });
  }

  main().catch(console.error); // Keep this to log any potential initialization errors in the future.
</script>
    </main>
    <footer>
        <hr>
        <!-- This displays the copyright with the year of the user's device -->
        <p>© <script>document.write(/\d{4}/.exec(Date())[0])</script> rsomonte</p>
        <p><em>Built with <a href="https://www.11ty.dev/">Eleventy v3.1.0</a></em></p>
    </footer>
</body>
</html>